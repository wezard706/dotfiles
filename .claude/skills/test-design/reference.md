# 単体テスト設計技法リファレンス

## 同値分割（Equivalence Partitioning）

同じ振る舞いをするグループ（同値クラス）に入力値を分割し、各グループから代表値を1つ選んでテストする。テストケース数を削減しながら網羅性を保つ。

**例（年齢が有効範囲 0〜150 の検証）**:

| 同値クラス | 代表値 | 期待結果 |
|-----------|--------|---------|
| 有効範囲内 | 25 | valid |
| 負の数 | -1 | invalid |
| 上限超過 | 200 | invalid |
| 数値以外 | "abc" | invalid |

---

## 境界値分析（Boundary Value Analysis）

同値クラスの境界付近はバグが発生しやすいため、境界値と境界の前後の値をテストする。同値分割と併用する。

**例（年齢の有効範囲: 0〜150）**:

| 入力値 | 分類 | 期待結果 |
|--------|------|---------|
| -1 | 無効（境界の外） | invalid |
| 0 | 有効（最小境界） | valid |
| 1 | 有効（最小+1） | valid |
| 149 | 有効（最大-1） | valid |
| 150 | 有効（最大境界） | valid |
| 151 | 無効（境界の外） | invalid |

---

## デシジョンテーブル（Decision Table）

複数の条件の組み合わせによって結果が変わるロジックをテストする。条件が複数あり、組み合わせが複雑な場合に特に有効。

**例（会員ランクと購入金額による割引率）**:

| 条件/結果 | C1 | C2 | C3 | C4 |
|----------|----|----|----|----|
| プレミアム会員 | Y | Y | N | N |
| 購入金額 >= 10,000円 | Y | N | Y | N |
| **割引率** | **20%** | **10%** | **5%** | **0%** |

ポイント: 全組み合わせが多い場合は、ビジネス上意味のある組み合わせに絞る。

---

## 状態遷移テスト（State Transition Testing）

オブジェクトが取り得る状態と、状態間の遷移をテストする。ドメインオブジェクトの状態管理を単体レベルで検証するのに有効。

**テストケースの導出**:

| 初期状態 | イベント | 期待する遷移後の状態 |
|---------|---------|-------------------|
| 注文受付 | 支払い完了 | 支払済 |
| 注文受付 | キャンセル | キャンセル済 |
| 支払済 | 出荷 | 出荷済 |
| 完了 | キャンセル | エラー（無効な遷移） |

ポイント: 正常な遷移だけでなく、無効な遷移でエラーになることも必ず検証する。

---

## エラー推測（Error Guessing）

経験と知識をもとに、バグが潜みやすい箇所を推測してテストケースを追加する。

| カテゴリ | 推測すべき値 |
|---------|------------|
| null 系 | nil, null, undefined |
| 空 | 空文字 `""`, 空配列 `[]`, 空ハッシュ `{}` |
| 数値 | 0, -1, 最大整数, 浮動小数点誤差 |
| 文字列 | 全角文字、絵文字、改行コード |
| 日時 | 閏年（2/29）、月末日、深夜0時、タイムゾーン |

---

## 技法の選択ガイド

| テスト対象の特徴 | 推奨技法 |
|-----------------|---------|
| 入力値に範囲・種類がある | 同値分割 + 境界値分析 |
| 複数条件の組み合わせでロジックが変わる | デシジョンテーブル |
| オブジェクトが複数の状態を持つ | 状態遷移テスト |
| 上記で拾えないエッジケースがある | エラー推測 |

**組み合わせルール**

- 同値分割を適用する場合は、境界値分析を必ず併用すること
- エラー推測は主技法を適用した後、常に補足として実施すること
